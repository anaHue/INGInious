{# This file is part of INGInious. See the LICENSE and the COPYRIGHTS files for #}
{# more information about the licensing of this file. #}

<div class="row">
    <div class="col-sm-3">
        <button class="btn btn-primary btn-success btn-block task_edit_add_variable_button" type="button" onclick="clickHandler()">
            <i class="fa fa-plus"></i>
            <div class="d-none d-sm-inline">{{ _("Add a variable") }}</div>
        </button>
    </div>
</div>
<br/>
<div class="row">
    <div class="col-sm-3">
        <div class="text-center">
            <h3>{{ _("Variables") }}</h3>
            
            <!-- TODO: get number of variables -->
            {% if false %}
                <p class="font-italic">{{ _("No variables for this exercise") }}</p>
            {% endif %}
            
            <div id="variable_list" class="list-group" role="tablist" onclick="selectVariableHandler(event)">
                <a href="#" class="list-group-item list-group-item-action active" data-toggle="list" role="tab">var1</a>
                <a href="#" class="list-group-item list-group-item-action" data-toggle="list" role="tab">var2</a>
                <a href="#" class="list-group-item list-group-item-action" data-toggle="list" role="tab">var3</a>
            </div>
        </div>
    </div>
    <!-- TODO: get data of variable -->
    <div class="col-sm-9">
        <div class="form-group row">
            <label for="name" class="col-sm-2 control-label">{{ _("Name") }}</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="variable_name" name="variable[var1][variable_name]" placeholder="name for this variable" value="{{ safe }}">
            </div>
        </div>

        <div class="form-group row">
            <label for="name" class="col-sm-2 control-label">{{ _("Type") }}</label>
            <div class="col-sm-10">
                <select class="form-control" id="variable_type" onchange="isCodeProblem()">
                    <!-- TODO: get types of variables with new API -->
                     <option value="variable_type_1">Type 1</option>
                     <option value="variable_type_2">Type 2</option>
                     <option value="variable_type_3">Type 3</option>
                </select>
            </div>
        </div>

        <div class="form-group row">
            <label for="name" class="col-sm-2 control-label">{{ _("Description") }}</label>
            <div class="col-sm-10">
                <textarea id="variable_description" class="code-editor form-control" name="variable[var1][variable_description]" data-x-language="rst" data-x-lines="10">{{ safe }}</textarea>
            </div>
        </div>

        <!-- TODO: get type selected of variable -->
        <div id="templateModel" class="form-group row">
            <label for="name" class="col-sm-2 control-label">{{ _("Template") }}</label>
            <div class="col-sm-10">
                <select class="form-control" id="variable_template">
                    <option value="variable_template_1">File 1</option>
                    <option value="variable_template_2">File 2</option>
                </select>
            </div>
        </div>

        <div class="form-group row">
            <label for="name" class="col-sm-2 control-label">{{ _("Value") }}</label>
            <div id="variable_value_input" class="col-sm-10"></div>
        </div>
    </div>
</div>
<script>
    function clickHandler() {
        $('#variable_list').append(
            '<a href="#" class="list-group-item list-group-item-action" data-toggle="list" role="tab">new_variable</a>'
        );
    };

    function selectVariableHandler(event) {
        if (event.target && event.target.matches("a.list-group-item")) {
            var variableName = event.target.textContent;
            $('#variable_name').val(variableName);
        }
    }

    function isCodeProblem() {
        if ($('#variable_type').val() === 'variable_type_1') {
            $('#templateModel').removeClass('d-none');

            $('#variable_value_input').html(`
                <textarea id="variable_value" class="code-editor form-control"
                name="variable[var1][variable_value]" data-x-language="rst" data-x-lines="10">{{ safe }}</textarea>
            `);

            CodeMirror.fromTextArea(document.getElementById('variable_value'), {
                lineNumbers: true,
                mode: "rst",
                theme: "default"
            });
        } else {
            $('#templateModel').addClass('d-none');
            $('#variable_value_input').html(
                `<input type="text" class="form-control" id="variable_value" name="variable[var1][variable_value]"
                placeholder="value for this variable" value="{{ safe }}">`
            );
        }
    }

    $(document).ready(function() {
        isCodeProblem();
    });
</script>